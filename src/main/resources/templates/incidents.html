<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã –ò–ë</title>
    <link rel="stylesheet" th:href="@{/css_styles/incidents.css}">
    <script defer th:src="@{/js_scrypts/incidents.js}"></script>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
<body>
<input type="hidden" id="currentUserLogin" th:value="${currentUser}">
<div class="container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <header>
        <h1>–ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã –ò–ë</h1>
        <div class="header-buttons">
            <button class="icon-button" id="backButton">
                <img src="/web/static/icons/back.png" alt="–ù–∞–∑–∞–¥">
            </button>
            <button class="icon-button" id="logoutButton">
                <img src="/web/static/icons/logout.png" alt="–í—ã—Ö–æ–¥">
            </button>
        </div>
    </header>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ -->
    <div class="incident-card">
        <h3>–ó–∞–≤–µ–¥–µ–Ω–Ω—ã–µ –≤ —Å–∏—Å—Ç–µ–º–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h3>

        <!-- –°–ø–∏—Å–æ–∫ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ -->
        <div class="incident-list" th:if="${!#lists.isEmpty(incidents)}">
            <div class="incident-item" th:each="incident : ${incidents}">
                <div class="incident-info">
                    <strong th:text="${incident.title}">–ù–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞</strong>
                    <span th:text="${incident.description}">–û–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞</span>
                </div>

                <div class="incident-meta">
                    <span th:text="${#temporals.format(incident.creationDate, 'HH:mm:ss dd.MM.yyyy')}">
                        00:00:00 01.01.2025
                    </span>
                    <span class="incident-level"
                          th:classappend="${incident.incidentLevel.name().toLowerCase()}"
                          th:text="${incident.incidentLevel.name()}">
                        LOW
                    </span>
                </div>

                <div class="incident-actions">
                    <button title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
                            th:onclick="'openEditIncident(\\'' + ${incident.id} + '\\')'">‚úèÔ∏è</button>
                    <button title="–£–¥–∞–ª–∏—Ç—å"
                            th:onclick="'deleteIncident(\\'' + ${incident.id} + '\\')'">üóëÔ∏è</button>
                </div>
            </div>
        </div>

        <!-- –ï—Å–ª–∏ –Ω–µ—Ç –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ -->
        <div class="no-incidents" th:if="${#lists.isEmpty(incidents)}">
            –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç
        </div>

        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
        <div class="pagination" th:if="${totalPages > 1}">
            <button class="page-btn"
                    th:if="${page > 1}"
                    th:onclick="'window.location.href=\'/incidents?page=' + (${page}-1) + '\''">‚Üê</button>

            <button class="page-btn"
                    th:each="p : ${#numbers.sequence(1, totalPages)}"
                    th:text="${p}"
                    th:classappend="${p == page} ? 'active' : ''"
                    th:onclick="'window.location.href=\'/incidents?page=' + ${p} + '\''"></button>

            <button class="page-btn"
                    th:if="${page < totalPages}"
                    th:onclick="'window.location.href=\'/incidents?page=' + (${page}+1) + '\''">‚Üí</button>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
    <button class="icon-add-button" id="addIncidentBtn">
        <img src="/web/static/icons/addInc.png" alt="–î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ü–∏–¥–µ–Ω—Ç">
    </button>
</div>
<!-- –ú–û–î–ê–õ–ö–ê: –î–û–ë–ê–í–õ–ï–ù–ò–ï –ò–ù–¶–ò–î–ï–ù–¢–ê -->
<div id="incidentModal" class="modal-overlay" aria-hidden="true">
    <div class="modal-frame">       <!-- —Ç—ë–º–Ω–∞—è —Ä–∞–º–∫–∞ -->
        <div class="modal-content">   <!-- –±–µ–ª–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
            <button class="modal-close" id="incidentCloseBtn" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úñ</button>
            <h2 class="modal-title">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞</h2>

            <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
            <input id="incidentTitle" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞">

            <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
            <textarea id="incidentDescription" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ"></textarea>

            <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select id="incidentCategory">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
            </select>

            <label>–£—Ä–æ–≤–µ–Ω—å –≤–∞–∂–Ω–æ—Å—Ç–∏</label>
            <select id="incidentLevel">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å –≤–∞–∂–Ω–æ—Å—Ç–∏</option>
            </select>

            <div class="modal-actions">
                <button id="cancelIncidentBtn">–û—Ç–º–µ–Ω–∞</button>
                <button id="chooseRecsBtn" class="danger">–í—ã–±—Ä–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</button>
                <button id="createIncidentBtn" class="danger" disabled>–°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </div>
    </div>
</div>

<!-- –ú–û–î–ê–õ–ö–ê: –í–´–ë–û–† –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ô -->
<div id="recsModal" class="modal-overlay" aria-hidden="true">
    <div class="modal-frame">
        <div class="modal-content recs-content">
            <button class="modal-close" id="recsCloseBtn" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úñ</button>
            <h2 class="modal-title">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞</h2>
            <div id="recsList" style="max-height:350px; overflow-y:auto; padding-right:6px;"></div>
            <div class="modal-actions" style="justify-content: center;">
                <button id="recsDoneBtn">–ì–æ—Ç–æ–≤–æ</button>
            </div>
        </div>
    </div>
</div>


</body>
</html>